# מדריך לוגים נקיים - Clean Logs Guide

## מה זה לוגים נקיים?

**לוגים נקיים** הם קבצי לוג מיוחדים שמתעדים **רק** את השיחות עם Cursor AI, ללא כל המידע הטכני, ה-debugging, וההודעות המפורטות שמופיעות בלוג הרגיל.

## למה זה חשוב?

### 🎯 מקרי שימוש

1. **ניתוח שיחות עם AI**
   - מה שאלתי?
   - מה קיבלתי?
   - האם התשובה הייתה טובה?

2. **שיפור פרומפטים**
   - איזה פרומפטים עובדים טוב
   - איזה פרומפטים צריכים שיפור
   - דפוסים שחוזרים על עצמם

3. **תיעוד לצוות**
   - הצגה למנהלים
   - דוחות ללקוחות
   - תיעוד ידע

4. **מעקב ביצועים**
   - כמה משימות בוצעו
   - מתי יש הכי הרבה פעילות
   - מה סוג המשימות הנפוץ

## מבנה הלוג הנקי

### פורמט קובץ

כל קובץ לוג נקרא: `conversation_YYYY-MM-DD.log`

דוגמה: `conversation_2025-02-15.log`

### פורמט רשומה

כל רשומה מכילה:
- 🕐 חותמת זמן
- 🔢 Task ID (אופציונלי)
- 📤 הפרומפט ששלחת
- 📥 התשובה שקיבלת
- קו הפרדה

```
======================================================================
[2025-02-15 14:30:00] Task ID: abc123

📤 PROMPT:
שלח מייל ללקוח #12345 עם עדכון הזמנה

📥 RESPONSE:
✉️ נשלח מייל אוטומטי ללקוח

======================================================================
```

## איך להשתמש?

### 1. הפעלת Cron Agent

כאשר מפעילים את `cron_agent.py`, הוא אוטומטית:
- יוצר תיקייה `clean_logs/`
- מתחיל לכתוב ללוג הנקי
- מציג את מיקום הקובץ

```bash
python cron_agent.py

# Output:
# 🚀 Cron Agent מתחיל לפעול!
# 📝 לוג נקי (פרומפטים ותשובות בלבד): clean_logs/conversation_2025-02-15.log
```

### 2. צפייה בלוג

#### צפייה פשוטה:
```bash
cat clean_logs/conversation_2025-02-15.log
```

#### מעקב חי:
```bash
tail -f clean_logs/conversation_2025-02-15.log
```

#### שימוש בסקריפט הייעודי:
```bash
./view_clean_logs.sh
```

תפריט אינטראקטיבי עם אפשרויות:
1. הצג לוג של היום
2. הצג את כל הלוגים
3. הצג 10 השיחות האחרונות
4. חיפוש בלוגים
5. מעקב חי (live tail)
6. צפה בדוגמה

### 3. ניתוח לוגים

הרץ סקריפט ניתוח:
```bash
python analyze_clean_logs.py
```

הסקריפט מציג:
- 📈 סטטיסטיקות כלליות
- ⏰ ניתוח זמני (שיחות לפי יום/שעה)
- 🎯 סוגי תשובות
- 💬 ניתוח פרומפטים

#### דוגמת פלט:

```
📊 ניתוח לוגים נקיים
======================================================================

📈 סטטיסטיקות כלליות:
----------------------------------------------------------------------
   סה"כ שיחות: 35
   תקופה: 2025-02-13 - 2025-02-15
   אורך פרומפט ממוצע: 42 תווים
   אורך תשובה ממוצע: 38 תווים

⏰ ניתוח זמני:
----------------------------------------------------------------------
   שיחות לפי יום:
      2025-02-13: ████████ 8
      2025-02-14: ███████████████ 15
      2025-02-15: ████████████ 12

   שיחות לפי שעה:
      09:00 - 09:59: ████ 4
      10:00 - 10:59: ███████ 7
      14:00 - 14:59: █████████ 9
      15:00 - 15:59: ████████████ 12

🎯 סוגי תשובות:
----------------------------------------------------------------------
   ✉️ Email        ████████████████ 15 (42.9%)
   📊 Report       █████████ 9 (25.7%)
   💾 Backup       ████ 4 (11.4%)
   🔄 Update       ████ 4 (11.4%)
   ✅ Success      ███ 3 (8.6%)

💬 ניתוח פרומפטים:
----------------------------------------------------------------------
   מילות מפתח נפוצות:
      מייל            18 פעמים
      דוח             12 פעמים
      עדכן            8 פעמים
      גיבוי           4 פעמים

   הפרומפטים הארוכים ביותר:
      1. (89 תווים) שלח מייל ללקוח עם עדכון מפורט על המשלוח והמלאי הנ...
      2. (76 תווים) צור דוח שבועי מפורט של כל המכירות והרווחים מהשבוע שע...
      3. (58 תווים) עדכן את מסד הנתונים עם המידע החדש מהקובץ שנשלח
```

## ההבדל מהלוג הרגיל

| לוג רגיל | לוג נקי |
|----------|---------|
| כולל debugging | רק שיחות |
| שגיאות מפורטות | תוצאות בלבד |
| Stack traces | מסקנות |
| זמני הרצה מדויקים | תאריך שעה פשוט |
| הודעות מערכת | פרומפטים ותשובות |
| API calls | השיחה עצמה |

### דוגמה להשוואה:

#### לוג רגיל (console):
```
==================================================
⏰ 2025-02-15 14:30:00
==================================================
📋 נמצאו 1 משימות פעילות

📝 מעבד משימה: שלח מייל ללקוח
🤖 Cursor AI מעבד: שלח מייל ללקוח
✅ המשימה הושלמה בהצלחה

--------------------------------------------------
📊 סטטיסטיקות:
   🎯 סה"כ משימות: 1
   ✅ הצליחו: 1
   ❌ נכשלו: 0
   ⏱️  זמן פעילות: 0:00:30
--------------------------------------------------
```

#### לוג נקי (clean_logs):
```
======================================================================
[2025-02-15 14:30:00] Task ID: abc123

📤 PROMPT:
שלח מייל ללקוח

📥 RESPONSE:
✉️ נשלח מייל אוטומטי ללקוח

======================================================================
```

## טיפים שימושיים

### 1. חיפוש מהיר

חיפוש כל הפרומפטים שקשורים למיילים:
```bash
grep -A 2 "PROMPT" clean_logs/*.log | grep -i "מייל\|email"
```

חיפוש תשובות שנכשלו:
```bash
grep -B 2 "נכשל\|failed" clean_logs/*.log
```

### 2. ספירת שיחות

ספירת כמה שיחות היו היום:
```bash
grep -c "^=====" clean_logs/conversation_$(date +%Y-%m-%d).log
```

### 3. ייצוא לפורמטים אחרים

ייצוא ל-JSON:
```bash
# TODO: יצירת סקריפט המרה ל-JSON
```

ייצוא ל-CSV:
```bash
# TODO: יצירת סקריפט המרה ל-CSV
```

### 4. גיבוי לוגים

גיבוי אוטומטי:
```bash
# הוסף ל-crontab
0 0 * * * tar -czf ~/backups/clean_logs_$(date +%Y%m%d).tar.gz ~/cron-agent/clean_logs/
```

### 5. ניקוי לוגים ישנים

מחיקת לוגים מלפני 30 יום:
```bash
find clean_logs/ -name "conversation_*.log" -mtime +30 -delete
```

שמירת רק 10 הלוגים האחרונים:
```bash
ls -t clean_logs/conversation_*.log | tail -n +11 | xargs rm -f
```

## הגדרות מתקדמות

### שינוי מיקום תיקיית הלוג

ערוך את `cron_agent.py`:
```python
agent = CronAgent(
    todoist_token=token,
    clean_log_dir="my_custom_logs"  # תיקייה מותאמת אישית
)
```

### שינוי פורמט הלוג

ערוך את קלאס `CleanLogger` ב-`cron_agent.py`:
```python
def log_conversation(self, prompt: str, response: str, task_id: str = None):
    log_entry = f"""
🕐 {timestamp}
📝 Task: {task_id}
Q: {prompt}
A: {response}
---
"""
```

### הוספת metadata נוסף

ניתן להוסיף:
- משך זמן הביצוע
- סטטוס ההצלחה
- קטגוריה של המשימה
- פרטי המשתמש

## שאלות נפוצות

### ❓ הלוג הנקי לא נוצר?

**תשובה:** ודא ש:
1. התיקייה `clean_logs/` קיימת
2. יש הרשאות כתיבה
3. ה-CronAgent אותחל עם `clean_logger`

### ❓ איך לשתף לוגים עם הצוות?

**תשובה:** אפשרויות:
1. שיתוף הקובץ ישירות
2. העלאה ל-Git repository (ללא sensitive data)
3. שימוש ב-log aggregation service
4. ייצוא ל-PDF/HTML

### ❓ האם הלוג הנקי מכיל מידע רגיש?

**תשובה:** כן! הלוג מכיל:
- פרומפטים (עשויים לכלול מידע רגיש)
- תשובות (עשויות לכלול נתונים)
- Task IDs (עשויים לקשור לנתונים)

**המלצה:** 
- אל תשתף לוגים בפומבי
- אל תעלה ל-Git ללא sanitization
- שמור על הרשאות קובץ מוגבלות

### ❓ איך למנוע שמירת משימות מסוימות?

**תשובה:** הוסף סינון ב-`CursorAgent.execute()`:
```python
# אל תשמור משימות עם מילת "פרטי"
if "פרטי" in task_content.lower():
    return result  # לא שומר ללוג נקי
```

## סיכום

הלוגים הנקיים הם כלי חשוב ל:
- ✅ מעקב אחר שיחות עם AI
- ✅ שיפור פרומפטים
- ✅ תיעוד פעילות
- ✅ ניתוח דפוסים
- ✅ הצגה למנהלים/לקוחות

**הם אינם:**
- ❌ תחליף ללוג הרגיל
- ❌ כלי debugging
- ❌ מכילים פרטים טכניים

**תמיד שמור את שני סוגי הלוגים!**

---

## קישורים שימושיים

- [README.md](README.md) - תיעוד ראשי
- [presentation_outline.md](presentation_outline.md) - מצגת מלאה
- [clean_logs/README.md](clean_logs/README.md) - מדריך תיקיית הלוגים

## תמיכה

יש שאלות? פתח issue ב-GitHub או צור קשר במייל.
