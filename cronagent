#!/usr/bin/env python3
"""
Cron Agent - Unified command-line interface.

Commands:
    ./cronagent setup       Run first-time setup
    ./cronagent install     Install scheduler
    ./cronagent status      Check scheduler status
    ./cronagent uninstall   Remove scheduler
    ./cronagent             Run agent manually
"""

import sys
from pathlib import Path

# Get paths
root_dir = Path(__file__).parent
src_dir = root_dir / "src"
venv_python = src_dir / "venv" / "bin" / "python3"

# Check if running setup command
if len(sys.argv) > 1 and sys.argv[1] == "setup":
    # Run setup using system Python
    sys.path.insert(0, str(src_dir))
    import setup
    setup.main()
    sys.exit(0)

# For all other commands, check if setup was run
if not venv_python.exists():
    print("âŒ Virtual environment not found!")
    print()
    print("Please run setup first:")
    print("  ./cronagent setup")
    print()
    sys.exit(1)

# Translate subcommands to flags for compatibility with cron_agent.py
args = sys.argv[1:]
if len(args) > 0:
    if args[0] == "install":
        args[0] = "--install"
    elif args[0] == "uninstall":
        args[0] = "--uninstall"
    elif args[0] == "status":
        args[0] = "--status"

# Use venv Python for all other commands
import subprocess
result = subprocess.run(
    [str(venv_python), str(src_dir / "cron_agent.py")] + args,
    cwd=root_dir
)
sys.exit(result.returncode)
