# Setup Workflow

Complete setup process with Cursor CLI integration.

## Step-by-Step Setup

### 1. Python Check

```
ðŸ“‹ Checking Python installation...
âœ… Python 3.11.7 installed
```

**Requirements**: Python 3.8 or higher

---

### 2. Cursor CLI Check & Login

```
ðŸ¤– Checking Cursor CLI...
âœ… Found Cursor CLI: /Users/you/.local/bin/cursor

ðŸ” Checking Cursor authentication...
```

#### Scenario A: Already Logged In

```
âœ… Already logged in
   Account: your.email@example.com
```

âœ… **No action needed** - Setup continues

---

#### Scenario B: Not Logged In

```
âš ï¸  Not logged in to Cursor

ðŸ“ Cursor Login Required

To use AI-powered task execution, you need to login to Cursor.
This will open a browser window for authentication.

Login to Cursor now? (Y/n):
```

**Options**:

1. **Press Enter or type `y`** â†’ Opens browser for login
   ```
   ðŸ”“ Starting Cursor login...
      A browser window will open
      Please complete the authentication
   
   [Browser opens with auth page]
   
   âœ… Successfully logged in to Cursor!
   ```

2. **Type `n`** â†’ Skip login (fallback mode)
   ```
   âš ï¸  Skipping Cursor login
      Agent will use fallback simulation mode
      To login later, run: cursor agent login
   ```

---

#### Scenario C: Cursor Not Installed

```
âš ï¸  Cursor CLI not found
   Agent will use fallback simulation mode
   To enable AI mode, install Cursor from: https://cursor.sh
```

âœ… **Setup continues** - Agent works in fallback mode

---

### 3. Virtual Environment

```
ðŸ“¦ Creating virtual environment...
âœ… Virtual environment created
```

Creates `src/venv/` with isolated Python environment.

---

### 4. Dependencies Installation

```
ðŸ“¥ Installing dependencies...
   Installing packages from requirements.txt...
âœ… All dependencies installed
```

Installs:
- `requests` - API calls
- `schedule` - Task scheduling
- `python-dotenv` - Environment variables
- `todoist-api-python` - Todoist SDK

---

### 5. Todoist Token Configuration

```
ðŸ“ Configuring .env file...

ðŸ”‘ Todoist API Token

Get your token from:
https://todoist.com/app/settings/integrations/developer

Enter your Todoist API token: [paste token here]
```

**What happens**:
- Creates `.env` file in project root
- Saves token securely
- Adds default configuration

**`.env` file created**:
```bash
# Cron Agent Configuration
# Auto-generated by setup

TODOIST_TOKEN=your_token_here

# Refresh interval for task processing (in seconds)
# Examples: 300 = 5 minutes, 600 = 10 minutes, 60 = 1 minute
REFRESH_INTERVAL_SECONDS=300

# Use Cursor CLI for task execution (true/false)
# Set to true to use real Cursor AI, false for fallback simulation
USE_CURSOR_CLI=true
```

---

### 6. Setup Complete

```
============================================================
âœ… Setup completed successfully!
============================================================

ðŸ“‹ Next Steps:

1. Install scheduler:
   ./cronagent install

2. Check status:
   ./cronagent status

â„¹ï¸  macOS Notes:
   - Will install LaunchAgent in ~/Library/LaunchAgents/
   - No sudo required
   - Runs automatically on login

ðŸ“š More Info:
   - README: cat docs/README.md
   - Setup guide: docs/setup-guide.html

ðŸŽ‰ Success!
```

---

## Quick Setup (No Prompts)

If you want to skip interactive prompts:

```bash
# 1. Create .env file manually
cat > .env << EOF
TODOIST_TOKEN=your_token_here
REFRESH_INTERVAL_SECONDS=300
USE_CURSOR_CLI=true
EOF

# 2. Login to Cursor (if not already)
cursor agent login

# 3. Run setup with existing config
python3 src/setup.py
```

---

## Troubleshooting Setup

### Issue: "Python 3.8+ required"

**Solution**:
```bash
# macOS
brew install python3

# Ubuntu/Debian
sudo apt install python3 python3-pip

# Check version
python3 --version
```

---

### Issue: "Cursor CLI not found"

**Symptoms**:
- Setup says CLI not found
- Agent runs in fallback mode

**Solution**:

1. **Install Cursor IDE** from https://cursor.sh

2. **Verify installation**:
   ```bash
   which cursor
   # Should show: /Users/you/.local/bin/cursor
   ```

3. **If not found**, install shell integration:
   ```bash
   cursor agent install-shell-integration
   source ~/.zshrc  # or ~/.bashrc
   ```

4. **Verify again**:
   ```bash
   cursor --version
   ```

---

### Issue: "Cursor login timeout"

**Symptoms**:
- Browser opens but login doesn't complete
- Setup times out after 2 minutes

**Solution**:

1. **Complete login manually** after setup:
   ```bash
   cursor agent login
   ```

2. **Check status**:
   ```bash
   cursor agent status
   # Should show: âœ“ Logged in as your.email@example.com
   ```

3. **If still failing**:
   - Check internet connection
   - Try different browser
   - Clear browser cache
   - Contact Cursor support

---

### Issue: "Invalid Todoist token"

**Symptoms**:
- Token validation fails during install
- "Authentication failed" error

**Solution**:

1. **Get new token**:
   - Go to: https://todoist.com/app/settings/integrations/developer
   - Copy the API token

2. **Update `.env` file**:
   ```bash
   nano .env
   # Update TODOIST_TOKEN=new_token_here
   ```

3. **Re-run setup**:
   ```bash
   python3 src/setup.py
   ```

---

### Issue: "Permission denied" creating venv

**Solution**:
```bash
# Ensure you have write permissions
chmod +w src/
python3 src/setup.py
```

---

## Re-running Setup

If you need to re-run setup (e.g., new token, update configuration):

```bash
# Setup will detect existing files
python3 src/setup.py

# It will prompt:
# "âš ï¸ .env file already exists"
# "Update the Token? (y/N):"

# Choose:
# - y: Update token
# - N: Keep existing (default)
```

---

## Post-Setup Verification

After setup completes, verify everything:

```bash
# 1. Check .env file exists
cat .env

# 2. Check Cursor login
cursor agent status

# 3. Check virtual environment
ls src/venv/

# 4. Check dependencies
src/venv/bin/pip list | grep -E "requests|schedule|todoist"

# 5. Test agent (without installing scheduler)
python3 src/cron_agent.py
# Press Ctrl+C to stop
```

**Expected output**:
```
ðŸ” Validating Todoist API connection...
âœ… Todoist API connection validated successfully!

ðŸ¤– Cursor CLI mode: ENABLED
   Tasks will be executed by real Cursor AI

ðŸš€ Cron Agent starting!
â° Will run every 300 seconds
ðŸ“ Clean log (prompts and responses only): clean_logs/conversation_2026-02-15.log
ðŸ›‘ Press Ctrl+C to stop
==================================================
```

---

## Environment Variables Explained

After setup, your `.env` file contains:

| Variable | Default | Description |
|----------|---------|-------------|
| `TODOIST_TOKEN` | (your token) | Todoist API authentication token |
| `REFRESH_INTERVAL_SECONDS` | 300 | How often to check for tasks (seconds) |
| `USE_CURSOR_CLI` | true | Enable AI execution (true) or fallback (false) |

**Customization**:

```bash
# Check every minute
REFRESH_INTERVAL_SECONDS=60

# Check every 10 minutes
REFRESH_INTERVAL_SECONDS=600

# Disable AI mode (use simulation)
USE_CURSOR_CLI=false
```

---

## Next Steps After Setup

1. **Install Scheduler**:
   ```bash
   ./cronagent install
   ```

2. **Add Test Task** in Todoist:
   - Task: "Calculate 5 + 3"

3. **Wait** for next run (or check logs)

4. **Verify** in Todoist:
   - Task should have comment with answer
   - Task should be marked complete

5. **Monitor Logs**:
   ```bash
   tail -f clean_logs/conversation_*.log
   ```

---

**Setup Time**: ~2-5 minutes  
**One-time Process**: Yes  
**Requires Sudo**: No  

For ongoing usage, see [README.md](README.md)
